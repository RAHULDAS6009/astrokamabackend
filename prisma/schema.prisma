// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Admin {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String
  createdAt DateTime @default(now())
}

model Student {
  id        Int     @id @default(autoincrement())
  studentId String  @unique
  name      String
  email     String? @unique
  gender    String?
  password  String

  branchId                 String?
  branch                   Branch? @relation(fields: [branchId], references: [id])
  rollNo                   Int? // Sequential number within course/batch
  gurdianName              String?
  relationWithGurdain      String?
  courseMode               String // "Online" or "Offline"
  courseDetails            String
  communicationAddress     String
  permanentAddress         String
  mobileNumber             String
  whatsappNumber           String? // Added WhatsApp number field
  dateOfBirth              String
  placeOfBirth             String
  educationalQualification String
  extraExperience          String?
  astrologicalExperience   String?
  occupation               String?
  photoUrl                 String?
  certificateUrl           String?
  idProofUrl               String?

  createdAt DateTime @default(now())

  fees Fee[]
}

model Course {
  id          Int     @id @default(autoincrement())
  ranking     Int     @unique
  name        String // e.g., "Offline Astrology Full Course"
  description String?
  bannerpdf   String?
  bannerimage String?

  gridTitle String[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model location {
  id       String   @id @default(uuid())
  location String   @unique
  branches Branch[]
}

model Branch {
  id String @id @default(uuid())

  location   location? @relation(fields: [locationId], references: [id])
  locationId String?

  uploadPhoto1 String?
  uploadPhoto2 String?

  text     String?
  isActive Boolean @default(true)

  tabHeader1 String?
  tabHeader2 String?

  name           String
  branchCode     String?    @unique
  color          String?
  durationMonths Int?
  module         String?
  daysPerWeek    String?
  daysJSON       String? //isko timing jesa bana denge //Sun - 1:00 pm to 5 pm 
  noofsemster    Int?
  admissionfee   Int?
  monthlyfee     Int?
  classHour      Int?
  semsters       Semester[]

  classType        String? //weekly or monthly 
  daysPerClassType Int?

  student       Student[]
  studyMaterial StudyMaterial[]
}

model Semester {
  id            String          @id @default(uuid())
  name          String
  number        Int?
  startDate     String?
  endDate       String?
  fees          Int?
  lateFeeDate   String?
  lateFeeFine   Int?
  admissionFee  Int? // Admission fee for first semester
  studyMaterial StudyMaterial[]
  feeRecords    Fee[] // Payment records for this semester

  branch   Branch? @relation(fields: [branchId], references: [id])
  branchId String?
}

model StudyMaterial {
  id         Int       @id @default(autoincrement())
  title      String
  type       String // "PDF", "DOC", "Image", "Video"
  url        String //url of that type
  createdAt  DateTime  @default(now())
  branch     Branch?   @relation(fields: [branchId], references: [id])
  branchId   String?
  semester   Semester? @relation(fields: [semesterId], references: [id])
  semesterId String?
}

model Fee {
  id        Int     @id @default(autoincrement())
  studentId Int
  student   Student @relation(fields: [studentId], references: [id])

  // Semester relation
  semesterId String?
  semester   Semester? @relation(fields: [semesterId], references: [id])

  // Payment Details
  description String? // "Admission Fee - Semester 1", "Month Jan-25", etc.
  amount      Float
  lateFine    Float   @default(0)

  // Payment Status
  status      String    @default("Pending") // "Paid", "Pending", "Overdue"
  paymentMode String? // "Online - Razorpay", "Cash", "Bank Transfer"
  paymentDate DateTime?

  // Razorpay Details
  paymentId String? // Razorpay Payment ID
  orderId   String? // Razorpay Order ID

  // Legacy fields (keep for backward compatibility)
  month String?
  year  Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Consultation {
  id Int @id @default(autoincrement())

  consultationType String
  preferredMode    String

  consultationDate String

  fullName     String
  gender       String
  dateOfBirth  DateTime
  timeOfBirth  String?
  placeOfBirth String
  country      String
  state        String
  city         String
  pinCode      String

  phoneNumber  String
  emailAddress String?

  careerGuidance     Boolean @default(false)
  loveLife           Boolean @default(false)
  marriageLife       Boolean @default(false)
  healthWellbeing    Boolean @default(false)
  financialCondition Boolean @default(false)
  business           Boolean @default(false)
  spiritualGrowth    Boolean @default(false)
  others             String?

  consultedBefore   Boolean
  specificQuestions String?

  openToRemedies      String?
  declarationAccepted Boolean
  signature           String?
  declarationDate     DateTime?

  onlineFee     Float?
  offlineFee    Float?
  bookingAmount Float?
  timeSlot      TimeSlot?

  razorpayOrderId   String?
  razorpayPaymentId String?
  razorpaySignature String?
  paymentStatus     String  @default("Pending") // Pending / Paid / Failed

  status    String   @default("Pending")
  createdAt DateTime @default(now())
}

model ScheduleTemplate {
  id        Int        @id @default(autoincrement())
  name      String // "Morning Slots", "Weekend Schedule", etc.
  dayOfWeek Int? // 0=Sunday, 1=Monday, ... 6=Saturday (null for date-specific)
  isActive  Boolean    @default(true)
  slots     TimeSlot[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model TimeSlot {
  id          Int      @id @default(autoincrement())
  date        DateTime // Specific date for this slot
  startTime   String // "09:00"
  endTime     String // "10:00"
  duration    Int // in minutes (e.g., 60)
  slotType    String   @default("full") // "full", "half", "custom"
  isBooked    Boolean  @default(false)
  isBlocked   Boolean  @default(false) // Admin can block slots
  maxBookings Int      @default(1)

  // Relations
  templateId Int?
  template   ScheduleTemplate? @relation(fields: [templateId], references: [id])

  consultationId Int?          @unique
  consultation   Consultation? @relation(fields: [consultationId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([date])
  @@index([isBooked, isBlocked])
}

model Review {
  id        Int      @id @default(autoincrement())
  rating    Int?
  name      String?
  phoneno   String?
  email     String?
  feedback  String
  status    String // "Pending", "Approved", "Rejected"
  imageUrl  String?
  clientId  Int?
  createdAt DateTime @default(now())
}

model CMS {
  id        Int      @id @default(autoincrement())
  section   String   @unique // "Hero", "About", "Philosophy", etc. 
  content   String
  imageUrl  String?
  updatedAt DateTime @updatedAt
}
